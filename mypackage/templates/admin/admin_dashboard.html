
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
      <title>Admin Dashboard</title>
    
      <!-- Bootstrap CSS -->
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
      <link rel="stylesheet" href="/static/css/admin.css">
    </head>
    <body>
    
      <!-- Mobile Overlay -->
      <div id="overlay" onclick="toggleSidebar()"></div>
    
      <!-- Sidebar -->
      <div id="sidebar" class="d-md-block mobile-hidden">
        <div class="sidebar-header d-flex justify-content-between align-items-center p-3">
          <h4><span class="text-dark"><i class="fa-solid fa-code"></i>Dev</span><span class="text-white">Studio</span></h4>
          <button class="btn btn-sm btn-danger d-md-none" onclick="toggleSidebar()">&times;</button>
        </div>
        <div class="sidebar-nav mt-4">
          <ul class="list-unstyled px-3">
            <li><a href="{{ url_for('admin_dashboard')}}">Dashboard</a></li>
            <li><a href="#" data-bs-toggle="modal" data-bs-target="#staticBackdrop">Add New Employee</a></li>
            <li><a href="{{ url_for('promote_employee') }}">Promote Employee</a></li>
            <li><a href="{{ url_for('promotion_list') }}">View Promotion List</a></li>
            <li><a href="{{ url_for('leave_applications') }}">View Leave Applications</a></li>
            <li><a href="{{ url_for('admin_logout')}}">Logout</a></li>
          </ul>
        </div>
      </div>
    
      <!-- Main Content -->
      <div id="main-content">
        <!-- Navbar -->
        <nav class="navbar bg-light p-3">
          <div class="container-fluid">
            <button class="btn btn-outline-primary d-md-none me-3" onclick="toggleSidebar()">
              <i class="fas fa-bars"></i>
            </button>
            <form class="d-flex flex-grow-1" role="search" action="{{ url_for('admin_dashboard') }}" method="get">
              <input class="form-control me-2" type="search" name="q" placeholder="Search by name, email, or file no." aria-label="Search">
              <button class="btn btn-outline-success" type="submit">Search</button>
            </form>
          </div>
        </nav>
    
        <!-- Flash Messages -->
        {% set msg = get_flashed_messages(with_categories=true) %}
        {% if msg %}
            {% for cat, message in msg %}
                <div class="alert alert-{{ 'danger' if cat == 'failed' else 'success' }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    
        <!-- Stats -->
        <div class="container mt-4">
          <div class="row">
            <div class="col-md-4">
              <div class="box">
                <i class="fa-solid fa-users"></i>
                <div>
                  <h4>{{ total_employees }}</h4>
                  <p>Active Employees</p>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="box bg-info">
                <i class="fa-solid fa-hand"></i>
                <div>
                  <h4>{{ pending_leaves_count }}</h4>
                  <p>Pending Leave Applications</p>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="box bg-secondary">
                <i class="fa-solid fa-hand"></i>
                <div>
                  <h4>{{ inactive }}</h4>
                  <p>Inactive Employees</p>
                </div>
              </div>
            </div>
          </div>
        </div>
    
        <!-- Employee Table -->
        <div class="container employee-list">
          <div class="table-responsive">
            <table class="table table-striped">
              <thead class="table-light">
                <tr>
                  <th>S/N</th>
                  <th>Name</th>
                  <th>Designation</th>
                  <th>G/Level</th>
                  <th>Station</th>
                  <th>Promotion <br> Due Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for employee in employees %}
                <tr>
                  <td>{{ loop.index }}</td>
                  <td class="employee d-flex align-items-center">
                    <img src="/static/uploads/{{employee.employee_dp}}" alt="staff dp">
                    <div>
                      <strong>{{ employee.employee_lname }} {{ employee.employee_fname }}</strong><br>
                      <small>{{ employee.employee_email }}</small>
                    </div>
                  </td>
                  <!-- <td>{{ employee.current_designation.designation if employee.current_designation else 'N/A' }}</td> -->

                  <td>{{ employee.job_history[-1].designation.designation if employee.job_history else 'N/A' }}</td>
                  <td>{{ employee.job_history[-1].grade_level if employee.job_history else 'N/A' }}</td>

                  <td>{{ employee.assigned_lga.lga_name if employee.station else 'N/A' }} LGA</td>
                  <td>{{ employee.promotion_due_date if employee.promotion_due_date else 'N/A' }}</td>
                  <td>
                    <!-- <a href="/employee/{{employee.employee_id}}/edit/" class="btn btn-secondary btn-sm">Edit</a> -->
                    <a href="/employee/{{employee.employee_id}}/view/" class="btn btn-info btn-sm">View</a>                    
                    <form action="{{ url_for('offboard_employee', employee_id=employee.employee_id) }}" method="post" style="display:inline;" onsubmit="return confirm('Are you sure you want to remove this employee?');">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token()}}">
                        <button type="submit" class="btn btn-danger btn-sm">Offboard</button>
                    </form>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    

 <!-- Modal For Add Employee -->
 <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="staticBackdropLabel">Add New Empolyee</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
            <h5 class="text-center text-primary mb-4">Enter Employee Details</h5>
            
            <form action="" id="addform" method="post">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
                <div class="row g-3 mb-3">
                    <div class="col-md-6">
                        <label for="lname" class="form-label">Last Name</label>
                        <input type="text" name="lname" id="lname" class="form-control" placeholder="Enter last name" required>
                    </div>
                    <div class="col-md-6">
                        <label for="fname" class="form-label">First Name</label>
                        <input type="text" name="fname" id="fname" class="form-control" placeholder="Enter first name" required>
                    </div>
                </div>
        
                <div class="mb-3">
                    <label for="email" class="form-label">Email Address</label>
                    <input type="email" name="email" id="email" class="form-control" placeholder="employee@example.com" required>
                </div>
        
                <div class="mb-3">
                    <label for="fileno" class="form-label">File Number</label>
                    <input type="text" name="fileno" id="fileno" class="form-control" placeholder="Enter file number" required>
                </div>
        
                <div class="mb-3">
                    <label for="designation_id" class="form-label">Designation</label>
                    <select name="designation_id" id="designation_id" class="form-select" required>
                        <option value="">Select Designation</option>
                        {% for desig in designations %}
                            <option value="{{ desig.designation_id }}">{{ desig.designation }}</option>
                        {% endfor %}
                    </select>
                </div>
        
                <div class="mb-3">
                    <label for="gl" class="form-label">Grade Level</label>
                    <input type="text" name="grade_level" id="gl" class="form-control" placeholder="Enter grade level(Eg.10)" required>
                </div>
        
                <div class="mb-3">
                    <label for="dept" class="form-label">Department</label>
                    <select name="dept" id="dept" class="form-select" required>
                        <option value="">Select Department</option>
                        {% for dept in departments %}
                            <option value="{{ dept.dept_id }}">{{ dept.department }}</option>
                        {% endfor %}
                    </select>
                </div>
        
                <div class="mb-3">
                    <label for="qualification" class="form-label">Qualification</label>
                    <select name="qualification" id="qualification" class="form-select" required>
                        <option value="">Select Qualification</option>
                        <option value="bsc">B.Sc</option>
                        <option value="msc">M.Sc</option>
                        <option value="phd">Ph.D</option>
                    </select>
                </div>
        
                <div class="row g-3 mb-3">
                    <div class="col-md-6">
                        <label for="dob" class="form-label">Date of Birth</label>
                        <input type="date" name="dob" id="dob" class="form-control" required>
                    </div>
                    <div class="col-md-6">
                        <label for="dateEmployed" class="form-label">Date Employed</label>
                        <input type="date" name="dateEmployed" id="dateEmployed" class="form-control" required>
                    </div>
                </div>
        
                <div class="mb-4">
                    <label for="password" class="form-label">Create Password</label>
                    <input type="password" name="password" id="password" class="form-control" placeholder="Enter a secure password" required>
                </div>
        
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary" id="addbtn">Add Employee</button>
                </div>
            </form>
        </div>
      </div>
    </div>
  </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/jquery-3.7.1.min.js"></script>

    <!-- JS -->
    <script>
        function toggleSidebar() {
          const sidebar = document.getElementById('sidebar');
          const overlay = document.getElementById('overlay');
          sidebar.classList.toggle('mobile-hidden');
          overlay.classList.toggle('show');
        }
      </script>

    <script>
    $(document).ready(function(){
            
        $('#addform').submit(function(event){
            event.preventDefault()

            var data2send = $("#addform").serialize()
            $.ajax({
            url: "{{ url_for('add_employee') }}",
            type:'POST',
            data: data2send,
            success: function(res){ 
                alert(res);
                  // Clear the form fields after successful submission
                $("#addform")[0].reset();
            },
            error: function(err){console.log(err)}

            })
            
        })

    })
    </script>
</body>
</html>